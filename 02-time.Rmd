# Comparing Geographies Across Time

```{r include = FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, out.width = "100%")
options(scipen = 999)

library(tidyverse)
library(DT)
```

Geographic boundaries change all the time. While large geographies like states are unlikely to change, places and even counties can change through annexation and secession that shift area between existing units or create new ones. Census geographies (i.e., blocks and tracts) generally remain stable between Decennial Censuses, but are always revised with each new Census through border adjustments and the creation of new units from fast growing areas. This means comparing indicators over time, especially across decades (e.g., pre-pandemic 2019 to anything post-pandemic in the 2020s), requires first ensuring the geography being compared is consistent. 

## Converting Vintages

The easiest way to ensure comparability is to use a crosswalk that converts the data into a common vintage of blocks and tracts (e.g., converting 2010 tracts to 2020 tracts to compare pre- and post-pandemic indicators). For example: 

```{r echo = FALSE}
crosswalk_ct00_ct10 <- 
  dplyr::tibble(
    `Tract 2000` = c(36047000301, 36047000302, 36047000302, 36047000100, 36047004700, 36047004700),
    `Tract 2010` = c(36047000301, 36047000100, 36047004700, 36047000100, 36047004700, 36047000301),
    Weight = c(1, 0.838, 0.162, 1, 0.99, 0.01)
  )

sample_data <- 
  dplyr::tibble(
    `Tract 2000` = c(36047000301, 36047000302, 36047000100, 36047004700),
    Population = c(10000, 15000, 7500, 20000)
  )

crosswalk_ct00_ct10 %>% 
  dplyr::filter(`Tract 2000` %in% c(36047000301, 36047000302)) %>% 
  DT::datatable() %>% 
  DT::formatPercentage("Weight", digits = 1)
```

What this shows is that all of tract 36047000301 in 2000 is within tract 36047000301 in 2010, while tract 36047000302 in 2000 was split into tracts 36047000100 and 36047004700 in 2010. Specifically, 83.8% of tract 36047000302 ended up in tract 36047000100 while the remaining 16.2% ended up in tract 36047004700. To convert data aggregated by 2000 tracts into data aggregated by 2010 tracts do the following: 

```{r eval = FALSE}
sample_data
```

```{r echo = FALSE}
sample_data %>% 
  DT::datatable() %>% 
  DT::formatRound("Population", digits = 0)
```

First, join the crosswalk by the 2000 tract ID: 

```{r eval = FALSE}
sample_data %>% 
  dplyr::inner_join(
    crosswalk_ct00_ct10, 
    by = "Tract 2000"
  )
```

```{r echo = FALSE}
sample_data %>% 
  dplyr::inner_join(
    crosswalk_ct00_ct10, 
    by = "Tract 2000"
  ) %>% 
  DT::datatable() %>% 
  DT::formatRound("Population", digits = 0) %>% 
  DT::formatPercentage("Weight", digits = 1)
```

Then, multiply the indicator by the appropriate weight:

```{r eval = FALSE}
sample_data %>% 
  dplyr::inner_join(
    crosswalk_ct00_ct10, 
    by = "Tract 2000"
  ) %>% 
  dplyr::mutate(
    Population_wt = Population * Weight
  )
```

```{r echo = FALSE}
sample_data %>% 
  dplyr::inner_join(
    crosswalk_ct00_ct10, 
    by = "Tract 2000"
  ) %>% 
  dplyr::mutate(
    Population_wt = Population * Weight
  ) %>% 
  DT::datatable() %>% 
  DT::formatRound(c("Population", "Population_wt"), digits = 0) %>% 
  DT::formatPercentage("Weight", digits = 1)
```

Finally, group by the 2010 tract ID and sum the weighted indicator:

```{r eval = FALSE}
sample_data %>% 
  dplyr::inner_join(
    crosswalk_ct00_ct10, 
    by = "Tract 2000"
  ) %>% 
  dplyr::mutate(
    Population_wt = Population * Weight
  ) %>%
  dplyr::summarize(
    .by = `Tract 2010`,
    Population = sum(Population_wt, na.rm = TRUE)
  )
```

```{r echo = FALSE}
sample_data %>% 
  dplyr::inner_join(
    crosswalk_ct00_ct10, 
    by = "Tract 2000"
  ) %>% 
  dplyr::mutate(
    Population_wt = Population * Weight
  ) %>%
  dplyr::summarize(
    .by = `Tract 2010`,
    Population = sum(Population_wt, na.rm = TRUE)
  ) %>% 
  DT::datatable()  %>% 
  DT::formatRound("Population", digits = 0)
```

**A note of caution:** this is an estimate! This process assumes people are distributed equally across the source geography such that, if X% of the source geography is located in the target geography, X% of the population (including X% of each age, race, etc.) is also within the target geography. If the population is concentrated or if different segments of the population are segregated, this conversion process will be inaccurate. Additionally, this process is only appropriate for counts and sums and not for medians or other quantiles. For rates or percentages, convert the numerator and denominator separately, then recompute the rate in the target geography.

### IPUMS NHGIS

The most straightforward source for geographic crosswalks is [IPUMS NHGIS](https://www.nhgis.org/geographic-crosswalks). While the crosswalks only go back to the 1990 Census, IPUMS allows you to go from many geographies to many other geographies across many supported census years:

|Source Geography |Target Geography |Source Year |Target Year| 
|:---------------:|:---------------:|:----------:|:---------:|
|Census Tracts    |Census Tracts    |1990        |2010       |
|Census Tracts    |Census Tracts    |2000        |2010       |
|Census Tracts    |Census Tracts    |2010        |2020       |
|Census Tracts    |Census Tracts    |2020        |2010       |
|Block Groups     |Block Groups, Census Tracts |2010 |2020 |
|Block Groups     |Block Groups, Census Tracts |2020 |2010 |
|Census Blocks    |Census Blocks, Block Groups, Census Tracts |1990 |2010 |
|Census Blocks    |Census Blocks, Block Groups, Census Tracts |2000 |2010 |
|Census Blocks    |Census Blocks, Block Groups, Census Tracts |2010 |2020 |
|Census Blocks    |Census Blocks, Block Groups, Census Tracts |2020 |2010 |

The crosswalk file name indicates which geographic levels, years, and geographic extent are covered in the file: `nhgis_[source level][source year]_[target level][target year]{_state FIPS code}.csv` (e.g., "nhgis_tr2020_tr2010_36.csv" converts 2020 Census tracts to 2010 Census tracts for New York, state code 36). 

Each file provides a different weight based on the universe of the indicator: 

|Weight |Description |Example Indicator |
|-------|------------|------------------|
|`wt_pop` |Expected proportion of source zone's **total population** located in target zone |Table B03002: Hispanic or Latino Origin by Race |
|`wt_hh` |Expected proportion of source zone's **households** (aka occupied housing units) located in target zone |Table B25003: Tenure |
|`wt_hu` |Expected proportion of source zone's **housing units** (occupied and vacant) located in target zone |Table B25136: Structure Type by Occupancy Status |
|`wt_ownhu` |Expected proportion of source zone's **owner-occupied housing units** located in target zone |Table B25081: Mortgage Status |
|`wt_renthu` |Expected proportion of source zone's **renter-occupied housing units** located in target zone |Table B25070: Gross Rent as a Percentage of Household Income |

### Brown University LTDB

If you need to look further back in time and are only interested in Census tracts, the [Longitudinal Tract Data Base at Brown University](https://s4.ad.brown.edu/projects/diversity/Researcher/LTBDDload/DataList.aspx) provides a crosswalk for comparing tracts from 1970-2020. These crosswalks are less detailed as they only convert Census tract geographies to the 2010 boundaries and only provide one weight. 

## Comparing Within Vintage

Once data is aggregated to the same vintage, it is generally possible to directly compare the values. The one caveat is comparing ACS data: in general, 1-year ACS and 5-year ACS should only be compared to the same survey and 5-year ACS cannot compare overlapping years (e.g., the 5-year 2019 data cannot be compared with the 5-year 2016 data because both are pooling data from 2015 and 2016).